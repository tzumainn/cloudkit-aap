---
- name: Fulfillment webhook
  hosts: localhost
  execution_strategy: parallel
  sources:
    - ansible.eda.webhook:
        host: 0.0.0.0
        port: 5000
  rules:
    - name: Create hosted cluster
      condition: event.meta.endpoint == "create-hosted-cluster"
      action:
        run_workflow_template:
          name: "{{ job_template_prefix }}-create-hosted-cluster-workflow"
          organization: "{{ job_template_organization }}"

    - name: Delete hosted cluster
      condition: event.meta.endpoint == "delete-hosted-cluster"
      action:
        run_job_template:
          name: "{{ job_template_prefix }}-delete-hosted-cluster"
          organization: "{{ job_template_organization }}"

    - name: Create virtual machine
      condition: event.meta.endpoint == "create-vm"
      action:
        run_job_template:
          name: "{{ job_template_prefix }}-create-vm"
          organization: "{{ job_template_organization }}"

    - name: Delete virtual machine
      condition: event.meta.endpoint == "delete-vm"
      action:
        run_job_template:
          name: "{{ job_template_prefix }}-delete-vm"
          organization: "{{ job_template_organization }}"

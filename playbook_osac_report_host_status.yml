- name: Report host workflow status
  hosts: localhost
  gather_facts: true
  vars:
    host: "{{ ansible_eda.event.payload }}"
    workflow_name: unknown
    workflow_status: unknown
  tasks:
    - name: Report workflow status
      when: >-
        workflow_status != "succeeded" or
        host.metadata.annotations["osac.openshift.io/ansible-workflow-status"] | default("") != workflow_status
      kubernetes.core.k8s:
        state: patched
        definition:
          apiVersion: cloudkit.openshift.io/v1alpha1
          kind: Host
          metadata:
            name: "{{ host.metadata.name }}"
            namespace: "{{ host.metadata.namespace }}"
            annotations:
              osac.openshift.io/ansible-workflow-name: "{{ workflow_name }}"
              osac.openshift.io/ansible-workflow-status: "{{ workflow_status }}"
              osac.openshift.io/ansible-workflow-time: "{{ ansible_date_time.iso8601 }}"
